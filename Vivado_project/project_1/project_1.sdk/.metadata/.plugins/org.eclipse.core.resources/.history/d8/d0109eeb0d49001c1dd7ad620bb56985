#include "xparameters.h"
#include "xneuralnetwork.h"
//#include "bias.h"
//#include "weights.h"

uint8_t getChoiceFromUser()
{
	xil_printf("Enter choice: \r\n");
	/* Read an input value from the console. */
	uint8_t value = inbyte();
	xil_printf("\r\n\r\n");

	return value-48;
}

int main()
{
	int input[80] = { -11, 10, 20, -15, 4, 40, 9, 1, -12, -13, 10, -18, -3, 11, 10, 4, 2, 5, 3, -3, 7, -9, 3, 9, -1, 8, -12, 1, 10, -6, 2, -3, -5, 3, 1, -2, 2, -1, 3, 1, -4, 0, -1, 3, -3, 2, -5, -2, 5, 5, -3, -2, 1, 2, -3, -4, -5, -5, -1, 0, 3, 3, 0, 2, 4, 4, 5, -1, 3, -1, 2, 1, 2, -3, 1, 0, -1, -2, 1, 0};
	int input1[80] = {-14, 3, 18, 17, 11, -11, -7, 16, 2, 3, 19, 8, -13, -7, 5, -14, -1, -3, -8, 5, 4, 19, -9, -1, -7, 3, 2, -15, 0, 7, -2, 2, 0, 8, 4, -7, 0, -2, -9, -5, -4, -3, 4, 5, -3, -5, -5, 1, 4, 10, 0, 5, 5, -4, 0, 5, 3, 6, -4, -4, -4, 5, 5, -4, 4, -1, 4, 0, -9, 6, -3, -3, 2, 0, -2, -3, -3, -2, -2, 5};
	char test[10] = {1, 2, 3, 4, 1, 6, 7, 8, 9, 1};

	//char test = (char) input[0];
	XNeuralnetwork nn;
	XNeuralnetwork_Initialize(&nn, XPAR_NEURALNETWORK_0_DEVICE_ID);


	while(!XNeuralnetwork_IsReady(&nn))
	{}

	XNeuralnetwork_Set_setBais_r(&nn, 0);
	XNeuralnetwork_Set_setWeight_r(&nn, 0);
	XNeuralnetwork_Set_runNN_r(&nn, 1);
	XNeuralnetwork_Write_input_r_Bytes(&nn, 0, (char*)input, 80);
	XNeuralnetwork_Start(&nn);
	while(!XNeuralnetwork_IsReady(&nn))
	{}

	u32 res = XNeuralnetwork_Get_return(&nn);

	while(!XNeuralnetwork_IsReady(&nn))
	{}

	XNeuralnetwork_Set_setBais_r(&nn, 0);
	XNeuralnetwork_Set_setWeight_r(&nn, 0);
	XNeuralnetwork_Set_runNN_r(&nn, 1);
	XNeuralnetwork_Write_input_r_Bytes(&nn, 0, (char*)input1, 80);
	XNeuralnetwork_Start(&nn);
	while(!XNeuralnetwork_IsReady(&nn))
	{}

	res = XNeuralnetwork_Get_return(&nn);

	/*while(!XNeuralnetwork_IsReady(&nn))
	{}

	XNeuralnetwork_Set_setBais_r(&nn, 0);
	XNeuralnetwork_Set_setWeight_r(&nn, 1);
	XNeuralnetwork_Set_runNN_r(&nn, 0);
	XNeuralnetwork_Write_biasWeight_input_r_Bytes(&nn, 0, (char*)test, 10);
	XNeuralnetwork_Start(&nn);
	while(!XNeuralnetwork_IsReady(&nn))
	{}*/

	//u32 res;// = XNeuralnetwork_Get_return(&nn);

	while(1){
		uint8_t choice = getChoiceFromUser();

		while(!XNeuralnetwork_IsReady(&nn))
		{}

		XNeuralnetwork_Set_setBais_r(&nn, 1);
		XNeuralnetwork_Set_setWeight_r(&nn, 1);
		XNeuralnetwork_Set_runNN_r(&nn, (char) choice);
		XNeuralnetwork_Start(&nn);
		while(!XNeuralnetwork_IsReady(&nn))
		{}

		res = XNeuralnetwork_Get_return(&nn);
		xil_printf("%d ", res);

	}
	xil_printf("Done\r\n");
	return 0;
}
